{% extends 'base.html.twig' %}

{% block title %}Gérer les CPV{% endblock %}

{% block body %}
<div class="achat-container" data-controller="cpv-index">
    <div class='align-items-center justify-content-center d-flex mt-3 bandeau-form-search'>
        <h5 class="mt-4 ms-3 blueF">Gérer les CPV</h5>
        <div class="bande ms-3"></div>
    </div>

    <div class='addAchat mt-5 p-3'>
        <span class="fr-icon-arrow-right-line ms-5" aria-hidden="true"></span>
        <div class=" ms-5 blueF align-items-center justify-content-center d-flex">Saisir un nouveau CPV</div>
        <button class="fr-btn btn-achat ms-5"> 
            <a href="{{ path('app_c_p_v_new') }}" class="text-center">Ajouter un CPV</a>
        </button>
        
        {{ form_start(form, {'attr': {'class': 'blueF align-items-center justify-content-center d-flex ms-auto', 'enctype': 'multipart/form-data'}}) }}
            {{ form_row(form.excel_file) }}
            <button type="submit" class="fr-btn btn-achat mt-4">Importer</button>
        {{ form_end(form) }}
        
        {% for flash_message in app.session.flashbag.get('success') %}
            <div class="alert alert-success">
                {{ flash_message }}
            </div>
        {% endfor %}
    </div>

    <div class="d-flex justify-content-between">
        <div class="w-50">
            <form method="get" action="{{ path('cpv') }}" class="d-flex flex-column">
                <h6 class="d-flex w-50 blueF mt-3">
                    <input type="text" class="w-75 searchcrud" name="search" value="{{ searchTerm }}" placeholder="Rechercher par code ou libellé">
                    <button type="submit" class="fr-btn btn-achat">Rechercher</button>
                </h6>
            </form>
        </div>
        <div>
            <button id="modifyAllCpvBtn" class="fr-btn btn-achat">Modifier le montant autorisé de tous les CPV</button>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th>Code CPV</th>
                <th>Libellé CPV</th>
                <th>Montant CPV autorisé</th>
                <th>État</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
        {% for c_p_v in pagination %}
            <tr>
                <td>{{ c_p_v.codeCpv }}</td>
                <td>{{ c_p_v.libelleCpv }}</td>
                <td>{{ c_p_v.mtCpvAuto }}</td>
                <td>{{ c_p_v.etatCpv == 1 ? 'Actif' : 'Inactif' }}</td>
                <td>
                    <a href="{{ path('app_c_p_v_show', {'id': c_p_v.id}) }}">Voir</a>
                    <a href="{{ path('app_c_p_v_edit', {'id': c_p_v.id}) }}">Modifier</a>
                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="5">Aucun CPV trouvé</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <div class="pagination">
        {{ knp_pagination_render(pagination,'@KnpPaginator/Pagination/twitter_bootstrap_v4_pagination.html.twig',{'pageParameterName': 'page', 'sortFieldParameterName': 'sortField', 'sortDirectionParameterName': 'sortDirection', 'routeParams': {'perPage': perPage, 'sortField': sortField, 'sortDirection': sortDirection}}) }}
    </div>
</div>

<!-- Modale en HTML/CSS -->
<div id="cpvModal" class="modal">
    <div class="modal-content">
        <span class="close" id="closeModal">&times;</span>
        <h5>Modifier le montant autorisé pour TOUS les CPV</h5>
        <input type="number" id="newCpvAmount" placeholder="Nouveau montant autorisé" class="form-control">
        <button id="saveCpvAmount" class="fr-btn btn-achat mt-3">Enregistrer</button>
    </div>
</div>

<style>

</style>
{% endblock %}
