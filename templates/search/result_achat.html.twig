{% extends 'base.html.twig' %}

{% block title %}Visualiser un achat{% endblock %}

{% block body %}
<div class="achat-container" data-controller="valid-achat">

    <div class='align-items-center d-flex mt-3 bandeau-form-search'>
        <span class="fr-icon-search-line" aria-hidden="true"></span>

        <h5 class="mt-4 ms-3 blueF">Visualiser un achat</h5>
        <div class="bande ms-3">
        </div>
    </div>
    <div class="form-container action-container-visu">
        <form class="search-form-all d-flex justify-content-around flex-wrap p-5">
            <div class="input-grp" style="flex-basis:25%">
                <div class="d-flex">
                    <div class="w-50 me-3">
                        <label for="ser" class="fr-label">Service</label>
                        <input type="text" id="ser" class="fr-input" value="{{result_achat.codeService}}" disabled>
                    </div>
                    <div class="w-50 ">
                        <label for="chrono" class="fr-label">N° Chrono</label>
                        <input type="text" id="chrono" class="fr-input" value="{{result_achat.numeroAchat}}" disabled>
                    </div>
                </div>
                <div class="d-flex flex-column">
                    <label for="id_demande_achat" class="fr-label">Identifiant de la demande d'achat</label>
                    <input type="text" id="da" class="fr-input" value="{{result_achat.idDemandeAchat}}"
                        disabled>
                </div>
                <div class="d-flex flex-column">
                    <label for="uti" class="fr-label">Utilisateur</label>
                    <input type="text" class="fr-input" id="tri" value="{{result_achat.utilisateurs.trigram}}" disabled>
                </div>
                <div class="d-flex flex-column">
                    <label for="mtn" class="fr-label">Montant achat HT</label>
                    <input type="text" id="mtn" class="fr-input" value="{{result_achat.montantAchat|number_format(2, '.', '') }}" disabled>
                </div>





            </div>
            <div class="input-grp" style="flex-basis:25%">

                <div class="d-flex flex-column">
                    <label for="sil" class="fr-label">Date sillage</label>
                    <input type="text" id="sil" class="fr-input"
                        value="{{result_achat.dateSillage | join ('') | date('d/m/y')}}" disabled>
                </div>
                <div class="d-flex flex-column">
                    <label for="chor" class="fr-label">Date de création CF</label>
                    <input type="text" id="dateCho" class="fr-input"
                        value="{{result_achat.dateCommandeChorus | join ('') | date('d/m/y')}}" disabled>
                </div>
                <div class="d-flex flex-column">
                    <label for="val" class="fr-label">Date de validation de l'achat</label>
                    <input type="text" id="valbox" class="fr-input"
                        value="{{result_achat.dateValidation | join ('') | date('d/m/y')}}" disabled>
                </div>
                <div class="d-flex flex-column">
                    <label for="tva" class="fr-label">TVA</label>
                    <input type="text" id="tva2" class="fr-input" value="{{result_achat.tvaIdent}}" disabled>
                </div>
            </div>
            <div class="input-grp" style="flex-basis:25%">
                <div class="d-flex flex-column">
                    <label for="sir" class="fr-label">N° SIRET</label>
                    <input type="text" id="sir" class="fr-input" value="{{result_achat.numSiret}}" disabled>
                </div>
                <div class="d-flex flex-column">
                    <label for="uo" class="fr-label">Unité organique</label>
                    <input type="text" id="uo2" class="fr-input" value="{{result_achat.codeUO}}" disabled>
                </div>
                <div class="d-flex flex-column">
                    <label for="for" class="fr-label">Formation</label>
                    <input type="text" id="for" class="fr-input" value="{{result_achat.codeFormation}}" disabled>
                </div>
                <div class="d-flex flex-column">
                    <label for="cpv" class="fr-label">CPV</label>
                    <input type="text" id="cpv" class="fr-input" value="{{result_achat.codeCPV|striptags}}" disabled>
                </div>
            </div>
            <div class="input-grp" style="flex-basis:25%">
                <div class="d-flex flex-column">
                    <label for="typ" class="fr-label">Type de marché</label>
                    <input type="text" id="typ" class="fr-input"
                        value="{% if result_achat.typeMarche == 0 %}MABC{% else %}MPPA{% endif %}" disabled>
                    <label for="typ" class="fr-label">Numero de marché</label>
                    <input type="text" id="numMarche" class="fr-input" value="{{result_achat.numeroMarche|striptags}}" disabled>
                    <label for="typ" class="fr-label">Numero EJ de marché</label>
                    <input type="text" id="ejMarche" class="fr-input" value="{{result_achat.numeroEjMarche|striptags}}" disabled>
                    <label for="typ" class="fr-label">Numero EJ</label>
                    <input type="text" id="ejMarche" class="fr-input" value="{{result_achat.numeroEj|striptags}}" disabled>
                </div>
                



            </div>

            <div class="d-flex w-100 flex-column">
                <div class="d-flex flex-column w-100">
                    <label for="obj " class="fr-label">Objet de l'achat</label>
                    <input type="text" class="fr-input" id="objet" value="{{result_achat.objetAchat}}" disabled>
                </div>
                <div class="d-flex flex-column w-100 ">
                    <label for="obs" class="fr-label">Observations</label>
                    <textarea rows="5" cols="30" class="fr-input" id="obs"
                        disabled>{{result_achat.observations}}</textarea>
                </div>
                {% if result_achat.etatAchat == 1 %}
                <div class="d-flex flex-column w-100">
                    <label for="com_annul" class="fr-label">Commentaire annulation</label>
                    <input class="fr-input" id="com_annul" disabled value="{{ result_achat.commentaireAnnulation }}">
                </div>
                {% endif %}
                <input class="fr-input hidden" size="20" type="text" id="ejbox" name="ej" value="14{{ result_achat.numeroEj | slice(2) }}" required minlength="10" maxlength="10" data-valid-achat-target="ej">
                <input class="fr-input hidden" type="text" id="valInt" value="{{ result_achat.dateValidInter | join('') | date('d/m/y') }}" disabled>
                <input class="fr-input hidden"  type="text" id="ejmarche" name="ejm" value="{{ result_achat.numeroEjMarche}}">
                <input class="fr-input hidden" type="number" id="comp" value="{{ cpvMt.computation | number_format(2, '.', '') }}" disabled>
                <input class="fr-input hidden" type="text" id="uo" value="{{ result_achat.codeUo.libelleUo }}" disabled>
                <input class="fr-input hidden" type="text" id="typem" value="{{ result_achat.typeMarche}}" disabled>
                <input class="fr-input hidden" type="text" id="four" value="{{ result_achat.numSiret.nomFournisseur}}" disabled>
                <input class="fr-input hidden" type="text" id="ej2" value="{{ result_achat.numeroEjMarche}}" disabled>
                <input class="fr-input hidden" type="text" id="numM" value="{{ result_achat.numeroMarche}}" disabled>
                <input type="text" id="tva"  class="fr-input hidden" value="{{result_achat.tvaIdent.tvaTaux}}" disabled>
                <input class="fr-input hidden" size="15" type="text" id="notbox" name="not" value="{{ result_achat.dateNotification | join('') | date('d/m/y') }}">
            </div>
            <div class="sub-btn d-flex justify-content-between align-items-centers">
<button 
    type="button" 
    class="fr-btn" 
    id="generatePdfBtn" 
    onclick="window.location.href='{{ path('generate_excel', { 'id': result_achat.id }) }}'"
    {{ result_achat.etatAchat != 2 ? 'disabled' : '' }}>
    Générer la pochette
</button>

        </form>
    </div>
</div>

</div>
</div>
{% endblock %}