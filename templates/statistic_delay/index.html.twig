{% extends 'base.html.twig' %}

{% block title %}Délai activité annuelle{% endblock %}

{% block body %}
<div class="stat-delay">
    <div class='align-items-center d-flex mt-3 bandeau-form-search'>

        <h5 class="mt-4 ms-3 blueF">Délai d'activité annuelle</h5>
        <div class="bande ms-3">
        </div>
    </div>
  <div class="form-container">
    {{ form_start(form, {'attr': {'class': 'd-flex justify-content-around flex-wrap p-5'}}) }}
    <div class="input-grp-tab" style="flex-basis:33%;">
      <div class="chronoStat d-flex">
        <div class="chronoY w-50 me-3">
    {{ form_row(form.date) }}

        </div>
        <div class="chronoJ w-50 ">
                          {{ form_row(form.utilisateurs) }}
        </div>
      </div>
            {{ form_row(form.code_cpv) }}
    </div>
    <div class="input-grp-tab" style="flex-basis:33%;">
              {{ form_row(form.code_formation) }}
          {{ form_row(form.code_uo) }}
    </div>
    <div class="input-grp-tab" style="flex-basis:33%;">
        {{ form_row(form.num_siret) }}
          {{ form_row(form.jourcalendar) }}
    </div>
    <div class="btn-submit">
    {{ form_row(form.tax, {'attr': {'class': 'hidden'}}) }}
       {{ form_row(form.recherche) }}
               {{ form_end(form) }}
</div>
  </div>
  {% if app.request.method == 'POST' %}
  <div class="p-3 font-weight-bold d-flex flex-row justify-content-between">
    <h3 class="  w-50 text-left ">Délai d'activié annuelle tableau</h3>
    <div class="" data-controller="pdf-generator-chartdelay">
      <button id="pdf" data-action="click->pdf-generator-chartdelay#generatePDFTable">Impression</button>
      <button id="ex" data-action="click->pdf-generator-chartdelay#exportTableToExcel">Export to Excel</button>
    </div>
  </div>
    <table border=1 id="delayTable">
      <thead>
        <th>Délai</th>
        <th>Janvier</th>
        <th>Février</th>
        <th>Mars</th>
        <th>Avril</th>
        <th>Mai</th>
        <th>Juin</th>
        <th>Juillet</th>
        <th>Aout</th>
        <th>Septembre</th>
        <th>Octobre</th>
        <th>Novembre</th>
        <th>Decembre</th>
        <th>Total</th>

        {% for achat in achats %}
        <tr>
          <th>{{ achat.source }}</th>
          <td>{{ achat.Janvier }}</td>
          <td>{{ achat.Février }}</td>
          <td>{{ achat.Mars }}</td>
          <td>{{ achat.Avril }}</td>
          <td>{{ achat.Mai }}</td>
          <td>{{ achat.Juin }}</td>
          <td>{{ achat.Juillet }}</td>
          <td>{{ achat.Aout }}</td>
          <td>{{ achat.Septembre }}</td>
          <td>{{ achat.Octobre }}</td>
          <td>{{ achat.Novembre }}</td>
          <td>{{ achat.Decembre }}</td>
          <td>
            {{ (achat.Janvier + achat.Février + achat.Mars + achat.Avril + achat.Mai + achat.Juin + achat.Juillet + achat.Aout + achat.Septembre + achat.Octobre + achat.Novembre + achat.Decembre) / 12 }}
          </td>
        </tr>
        {% endfor %}
      </thead>
      <tbody>
      </tbody>
    </table>


  <div class="align-items-center justify-content-center w-100 mw-75" data-controller="chartdelay">


    <div class=" p-3font-weight-bold d-flex flex-row justify-content-between">
      <h3 class=" w-50 text-left">Délai d'activié annuelle graphe</h3>
      <div class="" data-controller="pdf-generator-chartdelay">
        <button id="pdf" data-action="click->pdf-generator-chartdelay#downloadgraphBar">Impression</button>
      </div>
    </div>

    <canvas id="delayChart" data-chartdelay-target="delayChart"> </canvas>
    <div data-controller="pdf-generator-chartdelay" id="chartPie">
      <div class=" p-3 font-weight-bold d-flex flex-row justify-content-between">
        <h3 class=" w-50 text-left">Délai d'activié anuelle détaillé par traitement</h3>
        <div class="">
          <button id="pdf" data-action="click->pdf-generator-chartdelay#downloadgraphPie">Impression</button>
        </div>
      </div>
      <div class="d-flex flex-wrap w-100 align-items-center justify-content-center">
        <div class="w-25 ">
          <p class="text-center">{{achats_delay_all[0]["source"]}}</p>
          <canvas id="ctxAntenne" data-chartdelay-target="ctxAntenne"> </canvas>
        </div>
        <div class="w-25 ">
          <p class="text-center">{{achats_delay_all[1]["source"]}}</p>
          <canvas id="ctxBudget" data-chartdelay-target="ctxBudget"> </canvas>
        </div>
        <div class="w-25 ">
          <p class="text-center">{{achats_delay_all[2]["source"]}}</p>
          <canvas id="ctxAppro" data-chartdelay-target="ctxAppro"> </canvas>
        </div>
        <div class="w-25 ">
          <p class="text-center">{{achats_delay_all[3]["source"]}}</p>
          <canvas id="ctxFin" data-chartdelay-target="ctxFin"> </canvas>
        </div>
        <div class="w-25 ">
          <p class="text-center">{{achats_delay_all[5]["source"]}}</p>
          <canvas id="ctxPFAF" data-chartdelay-target="ctxPFAF"> </canvas>
        </div>
        <div class="w-25 ">
          <p class="text-center">{{achats_delay_all[4]["source"]}}</p>
          <canvas id="ctxChorus" data-chartdelay-target="ctxChorus"> </canvas>
        </div>
        <div class="w-25 ">
          <p class="text-center">Délai Total</p>
          <canvas id="ctxTotalDelay" data-chartdelay-target="ctxTotalDelay"> </canvas>
        </div>
      </div>
    </div>
</div>
<script>

  var transStat = {{transStat | json_encode | raw}}
  var notStat = {{notStat | json_encode | raw}}
  
  var achats_delay_all = {{achats_delay_all | json_encode | raw}}

</script>
{% endif %}
{% endblock %}